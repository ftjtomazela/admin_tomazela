
<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>PDV - Admin Piscina</title>

    <style>

        /* (Seu CSS estÃ¡ 100% igual, sem mudanÃ§as) */

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            background: linear-gradient(to bottom, #004e92 0%, #000428 100%);

            color: #ffffff;

            min-height: 100vh;

        }

        .admin-nav {

            background: #111827;

            padding: 12px 20px;

            margin-bottom: 20px;

            border-bottom: 2px solid #007bff;

            display: flex;

            gap: 10px;

            align-items: center;

            flex-wrap: wrap;

        }

        .nav-btn {

            background: #374151; color: #f3f4f6; border: none;

            padding: 10px 15px; border-radius: 8px; font-weight: bold;

            font-size: 0.9rem; cursor: pointer; text-decoration: none;

            transition: all 0.3s; font-family: inherit;

        }

        .nav-btn:hover { background: #4b5563; }

        .nav-btn.active { background: #007bff; color: #fff; } /* Azul Ativo */

        .nav-btn.logout { background: #dc2626; color: #fff; margin-left: auto; }

        .nav-btn.logout:hover { background: #ef4444; }



        .container {

            max-width: 1400px;

            margin: 0 auto;

            padding: 0 20px 20px 20px;

        }

        h1 {

            text-align: center;

            color: #fff;

            margin-bottom: 25px;

            font-size: 2.5rem;

        }

        .pdv-grid {

            display: grid;

            grid-template-columns: 1fr; /* 1 coluna mobile */

            gap: 20px;

        }

        @media (min-width: 768px) {

            .pdv-grid { grid-template-columns: 1fr 1fr; } /* 2 colunas tablet */

        }

        @media (min-width: 1200px) {

            .pdv-grid { grid-template-columns: 1fr 1fr 1fr; } /* 3 colunas desktop */

        }



        .pdv-coluna {

            background: linear-gradient(145deg, #2d3748, #1a202c);

            border-radius: 16px;

            padding: 20px;

            border: 2px solid #374151;

            max-height: 80vh;

            display: flex;

            flex-direction: column;

        }

        .pdv-coluna h2 {

            font-size: 1.5rem;

            color: #007bff;

            margin-bottom: 15px;

            border-bottom: 1px solid #4b5563;

            padding-bottom: 10px;

        }

       

        .cardapio-scroll {

            overflow-y: auto;

            flex: 1;

        }

        .item-cardapio {

            background: #374151;

            padding: 12px 15px;

            border-radius: 10px;

            margin-bottom: 10px;

            display: flex;

            justify-content: space-between;

            align-items: center;

            cursor: pointer;

            transition: all 0.3s;

        }

        .item-cardapio:hover {

            background: #4b5563;

        }

        .item-cardapio span {

            font-size: 1rem;

            font-weight: 500;

        }

        .item-cardapio .preco {

            font-weight: bold;

            color: #10b981; /* Verde */

        }



        .carrinho-scroll {

            overflow-y: auto;

            flex: 1;

            min-height: 200px;

        }

        .carrinho-item {

            background: #374151;

            padding: 12px 15px;

            border-radius: 10px;

            margin-bottom: 10px;

            display: flex;

            gap: 10px;

            align-items: center;

        }

       

        .carrinho-item-qty {

            display: flex;

            align-items: center;

            background: #2d3748;

            border-radius: 6px;

            padding: 2px;

        }

        .qty-btn {

            background: #007bff;

            color: #fff;

            border: none;

            width: 28px;

            height: 28px;

            font-size: 1.2rem;

            font-weight: bold;

            cursor: pointer;

            border-radius: 6px;

        }

        .qty-display {

            font-size: 1.1rem;

            font-weight: bold;

            padding: 0 10px;

            min-width: 20px;

            text-align: center;

        }

       

        .carrinho-info {

            flex: 1;

        }

        .carrinho-info .nome {

            font-weight: bold;

            font-size: 1.1rem;

        }

       

        .carrinho-preco {

            font-size: 0.9rem;

            color: #9ca3af;

            margin-top: 5px;

        }

        .input-preco {

            background: #4b5563;

            color: #fff;

            border: 1px solid #007bff;

            border-radius: 6px;

            padding: 5px;

            font-size: 1rem;

            font-weight: bold;

            width: 100px;

            font-family: inherit;

        }

        .input-preco:focus {

            outline: none;

            background: #5e6c80;

        }

       

        .carrinho-preco-total {

             font-size: 1.1rem;

            font-weight: bold;

            color: #10b981;

            text-align: right;

        }

        .btn-excluir {

            background: #dc2626;

            color: #fff;

            border: none;

            padding: 5px 10px;

            border-radius: 8px;

            font-weight: bold;

            cursor: pointer;

            margin-left: 5px;

        }

        #total-carrinho {

            margin-top: 15px;

            padding-top: 15px;

            border-top: 2px solid #007bff;

            font-size: 1.5rem;

            font-weight: bold;

            text-align: right;

        }

       

        .form-scroll {

            overflow-y: auto;

            flex: 1;

        }

        .form-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }

        .input-group { display: flex; flex-direction: column; }

        .input-group label { margin-bottom: 8px; color: #9ca3af; font-weight: bold; }

        .input-field { background: #374151; color: #fff; border: 2px solid #4b5563; border-radius: 8px; padding: 12px; font-size: 1rem; font-family: inherit; }

        .input-field:focus { outline: none; border-color: #007bff; }

       

        #btn-enviar-manual {

            width: 100%;

            background: #10b981;

            color: #fff;

            border: none;

            padding: 18px;

            border-radius: 12px;

            font-weight: bold;

            font-size: 1.1rem;

            cursor: pointer;

            transition: all 0.3s;

            margin-top: 20px;

        }

        #btn-enviar-manual:disabled {

            background: #4b5563; color: #9ca3af; cursor: not-allowed;

        }

    </style>

</head>

<body>
<div class="admin-nav">
Â  Â  <a href="admin_piscina.html" class="nav-btn">ğŸ  Painel</a>
Â  Â  <a href="produtos.html" class="nav-btn">ğŸ“¦ Produtos</a>
Â  Â  <a href="clientes.html" class="nav-btn">ğŸ‘¥ Clientes</a>
Â  Â  <a href="pdv_piscina.html" class="nav-btn active">âœï¸ PDV</a>
Â  Â  <a href="servicos_do_dia.html" class="nav-btn">ğŸ“‹ ServiÃ§os do Dia</a>
Â  Â  <a href="empresa.html" class="nav-btn">ğŸ¢ Empresa</a>
Â  Â  <a href="faturamento.html" class="nav-btn">ğŸ’² Faturamento</a>
Â  Â  <a href="recebimentos.html" class="nav-btn">ğŸ’° Recebimentos</a> 
Â  Â  <a href="ficha_visita.html" class="nav-btn">ğŸ“ Ficha de Visita</a>
Â  	<button id="logout-btn" class="nav-btn logout">Sair â”</button>
</div>

Â  	<div class="container">
Â  Â  Â  	<h1>âœï¸ PDV - LanÃ§ar ServiÃ§o/Venda</h1>

Â  Â  Â  	<div class="pdv-grid">
Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  	<div class="pdv-coluna" id="coluna-cardapio">
Â  Â  Â  Â  Â  Â  Â  	<h2>1. Itens</h2>
Â  Â  Â  Â  Â  Â  Â  	<div class="input-group" style="margin-bottom: 15px;">
                    <input type="text" id="search-item" class="input-field" placeholder="Buscar produto ou serviÃ§o..." onkeyup="filterProducts()">
                </div>
Â  Â  Â  Â  Â  Â  Â  	<div class="cardapio-scroll">
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<h3 style="color:#007bff; margin: 15px 0 10px 0;">ğŸ“¦ Produtos</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div id="produtos-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<p>Carregando produtos...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<h3 style="color:#007bff; margin: 15px 0 10px 0;">ğŸ”§ ServiÃ§os Avulsos</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div id="servicos-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  	</div>

Â  Â  Â  Â  Â  	<div class="pdv-coluna" id="coluna-carrinho">
Â  Â  Â  Â  Â  Â  Â  	<h2>2. Pedido Atual</h2>
Â  Â  Â  Â  Â  Â  Â  	<div class="carrinho-scroll" id="pedido-atual-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<p style="color: #9ca3af; text-align: center;">Selecione um cliente e adicione itens...</p>
Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  	<div id="total-carrinho">
Â  Â  Â  Â  Â  Â  Â  Â  Â  	Total: R$ 0,00
Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  	</div>

Â  Â  Â  Â  Â  	<div class="pdv-coluna" id="coluna-cliente">
Â  Â  Â  Â  Â  Â  Â  	<h2>3. Cliente e Fechamento</h2>
Â  Â  Â  Â  Â  Â  Â  	<div class="form-scroll">
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<form id="form-manual">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="search-cliente">Buscar Cliente</label>
                            <input type="text" id="search-cliente" class="input-field" placeholder="Digite o nome do cliente..." onkeyup="filterClients()">
                        </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="select-cliente">1. Selecionar Cliente</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<select id="select-cliente" class="input-field" onchange="preencherCliente()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="">--- Selecione um cliente ---</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<h3 style="color:#007bff; margin: 20px 0 10px 0;">2. Dados (AutomÃ¡tico)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="cliente-nome">Nome</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<input type="text" id="cliente-nome" class="input-field" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group" style="margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="cliente-endereco">EndereÃ§o</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<input type="text" id="cliente-endereco" class="input-field" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<h3 style="color:#007bff; margin: 20px 0 10px 0;">3. Pagamento</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="form-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="pagamento">Forma</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<select id="pagamento" class="input-field" onchange="toggleTroco(this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="pix">PIX</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="credito">CrÃ©dito</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="debito">DÃ©bito</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="dinheiro">Dinheiro</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<option value="mensalidade">LanÃ§ar na Mensalidade</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="input-group" id="troco-section" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<label for="troco-valor">Troco para?</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<input type="text" id="troco-valor" class="input-field" placeholder="Ex: 50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<button type="submit" id="btn-enviar-manual">LanÃ§ar ServiÃ§o/Venda</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	</form>
Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  	</div>

Â  Â  Â  	</div>
Â  	</div>

<script type="module">
Â  	import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
Â  	import { getDatabase, ref, get, push } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
Â  	import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
Â  	
Â  	const firebaseConfig = {
Â  Â  Â  	apiKey: "AIzaSyB_2Ssx3a3CW3PEP2RBh7j5TQl1UPuSg4k",
Â  Â  Â  	authDomain: "tomazela-piscinas.firebaseapp.com",
Â  Â  Â  	databaseURL: "https://tomazela-piscinas-default-rtdb.firebaseio.com", 
Â  Â  Â  	projectId: "tomazela-piscinas",
Â  Â  Â  	storageBucket: "tomazela-piscinas.firebasestorage.app",
Â  Â  Â  	messagingSenderId: "776818671387",
Â  Â  Â  	appId: "1:776818671387:web:ca4211e6fa8f3f1c889dbe",
Â  Â  Â  	measurementId: "G-PP230KYC4X"
Â  	};
Â  	
Â  	const app = initializeApp(firebaseConfig);
Â  	const database = getDatabase(app);
Â  	const auth = getAuth(app);
Â  	
Â  	const produtosRef = ref(database, 'produtos');
Â  	const clientesRef = ref(database, 'clientes');
Â  	const pedidosRef = ref(database, 'servicos'); 

Â  	const servicos_avulsos = [
Â  Â  Â  	{ id: 's0', nome: 'CobranÃ§a de Mensalidade', preco: 0.00 },
Â  Â  Â  	{ id: 's1', nome: 'Visita TÃ©cnica', preco: 80.00 }, 
Â  Â  Â  	{ id: 's2', nome: 'Limpeza Avulsa', preco: 120.00 }, 
Â  Â  Â  	{ id: 's3', nome: 'Troca de Areia', preco: 250.00 }, 
Â  Â  Â  	{ id: 's4', nome: 'Tratamento de Choque', preco: 150.00 }
Â  	];

Â  	// --- VARIÃVEIS GLOBAIS (AGORA USADAS PARA PESQUISA) ---
Â  	var carrinho = [];
Â  	var produtos_db = []; // Produtos do Firebase
Â  	var clientes_db = []; // Clientes do Firebase
    var todos_produtos_e_servicos = []; // Lista unificada para busca
Â  	var clienteSelecionado = null;
Â  	
Â  	
Â  	// --- VIGIA E LOGOUT ---
Â  	onAuthStateChanged(auth, (user) => {
Â  Â  Â  	if (!user) {
Â  Â  Â  Â  Â  	window.location.href = 'login_piscina.html';
Â  Â  Â  	} else {
Â  Â  Â  Â  Â  	initPage();
Â  Â  Â  	}
Â  	});
Â  	
Â  	const logoutBtn = document.getElementById('logout-btn');
Â  	logoutBtn.addEventListener('click', () => {
Â  Â  Â  	if (confirm("Tem certeza que deseja sair?")) {
Â  Â  Â  Â  Â  	signOut(auth);
Â  Â  Â  	}
Â  	});
Â  	
Â  	function initPage() {
Â  Â  Â  	carregarDadosDoFirebase();
Â  Â  Â  	document.getElementById('select-cliente').addEventListener('change', preencherCliente);
Â  Â  Â  	document.getElementById('form-manual').addEventListener('submit', enviarPedido);
Â  	}

Â  	// --- CARREGAR DADOS DO FIREBASE ---
Â  Â  	
Â  	async function carregarDadosDoFirebase() {
Â  Â  Â  	try {
Â  Â  Â  Â  Â  	const [produtosSnap, clientesSnap] = await Promise.all([
Â  Â  Â  Â  Â  Â  Â  	get(produtosRef),
Â  Â  Â  Â  Â  Â  Â  	get(clientesRef)
Â  Â  Â  Â  Â  	]);

Â  Â  Â  Â  Â  	// Processa Produtos
Â  Â  Â  Â  Â  	produtos_db = [];
Â  Â  Â  Â  Â  	if (produtosSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  	produtosSnap.forEach(child => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  	const item = child.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  	if (!item.pausado) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	item.id = child.key; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	produtos_db.push(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  Â  Â  Â  	});
Â  Â  Â  Â  Â  	}
Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  	// Processa Clientes
Â  Â  Â  Â  Â  	clientes_db = [];
Â  Â  Â  Â  Â  	if (clientesSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  	clientesSnap.forEach(child => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  	const item = child.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  	item.id = child.key; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  	clientes_db.push(item);
Â  Â  Â  Â  Â  Â  Â  	});
Â  Â  Â  Â  Â  	}
            
            // Unifica todos os itens para busca
            todos_produtos_e_servicos = [
                ...produtos_db.map(p => ({ ...p, tipo: 'produto' })),
                ...servicos_avulsos.map(s => ({ ...s, tipo: 'servico' }))
            ].sort((a, b) => a.nome.localeCompare(b.nome));

Â  Â  Â  Â  Â  	renderizarListas();

Â  Â  Â  	} catch (error) {
Â  Â  Â  Â  Â  	console.error("Erro ao carregar dados:", error);
Â  Â  Â  Â  Â  	alert("ERRO: NÃ£o foi possÃ­vel carregar os dados do Firebase.");
Â  Â  Â  	}
Â  	}
Â  	
Â  	// --- RENDERIZAÃ‡ÃƒO INICIAL (APENAS FILTRA E CHAMA AS FUNÃ‡Ã•ES DEDICADAS) ---
Â  	function renderizarListas() {
        clientes_db.sort((a, b) => a.nome.localeCompare(b.nome));
        renderClientsSelect(clientes_db);
        renderItemsContainers(todos_produtos_e_servicos);
Â  	}
    
    // --- LÃ“GICA DE FILTRO DE CLIENTES ---
    
    // FunÃ§Ã£o auxiliar para renderizar o SELECT do cliente
    function renderClientsSelect(clientList) {
Â  Â  Â  	const clientesSelect = document.getElementById('select-cliente');
Â  Â  Â  	// MantÃ©m a opÃ§Ã£o de placeholder
Â  Â  Â  	for (let i = clientesSelect.options.length - 1; i >= 1; i--) {
Â  Â  Â  Â  Â  	clientesSelect.remove(i);
Â  Â  Â  	}
Â  Â  Â  	clientList.forEach(item => {
            const endereco = item.enderecoRua && item.enderecoNum ? ` (${item.enderecoRua}, ${item.enderecoNum})` : '';
Â  Â  Â  Â  Â  	const option = new Option(`${item.nome}${endereco}`, item.id);
Â  Â  Â  Â  Â  	clientesSelect.add(option);
Â  Â  Â  	});
    }

    window.filterClients = function() {
        const searchInput = document.getElementById('search-cliente').value.toLowerCase().trim();
        
        const filteredList = clientes_db.filter(client => 
            client.nome.toLowerCase().includes(searchInput)
        );
        
        renderClientsSelect(filteredList);
        // â­ ATUALIZAÃ‡ÃƒO: Se a lista filtrada tiver apenas 1 resultado, seleciona-o
        if (filteredList.length === 1) {
            document.getElementById('select-cliente').value = filteredList[0].id;
        } else {
             document.getElementById('select-cliente').value = ""; // Limpa se houver mÃºltiplos
        }
        preencherCliente(); // Atualiza os dados do cliente selecionado no formulÃ¡rio
    }

    // --- LÃ“GICA DE FILTRO DE ITENS ---
    
    // FunÃ§Ã£o auxiliar para renderizar as caixas de Produtos e ServiÃ§os
    function renderItemsContainers(itemList) {
        const produtosContainer = document.getElementById('produtos-container');
        const servicosContainer = document.getElementById('servicos-container');
        
        produtosContainer.innerHTML = '';
        servicosContainer.innerHTML = '';
        
        const produtosFiltrados = itemList.filter(item => item.tipo === 'produto');
        const servicosFiltrados = itemList.filter(item => item.tipo === 'servico');

        // Renderiza Produtos
        if (produtosFiltrados.length === 0 && itemList.length > 0) { // Mostra sÃ³ se a busca nÃ£o achar produtos
            produtosContainer.innerHTML = '<p style="color: #9ca3af;">Nenhum produto encontrado.</p>';
        } else if (produtosFiltrados.length > 0) {
            produtosFiltrados.forEach(item => {
                produtosContainer.innerHTML += `
                    <div class="item-cardapio" onclick="adicionarProduto('${item.id}')">
                        <span>${item.nome}</span>
                        <span class="preco">R$ ${Number(item.preco).toFixed(2)}</span>
                    </div>
                `;
            });
        }

        // Renderiza ServiÃ§os
        if (servicosFiltrados.length === 0 && itemList.length > 0) { // Mostra sÃ³ se a busca nÃ£o achar serviÃ§os
            servicosContainer.innerHTML = '<p style="color: #9ca3af;">Nenhum serviÃ§o avulso encontrado.</p>';
        } else if (servicosFiltrados.length > 0) {
            servicosFiltrados.forEach(item => {
                const precoDisplay = item.id === 's0' ? 'VariÃ¡vel' : `R$ ${Number(item.preco).toFixed(2)}`;
                servicosContainer.innerHTML += `
                    <div class="item-cardapio" onclick="adicionarServico('${item.id}')">
                        <span>${item.nome}</span>
                        <span class="preco">${precoDisplay}</span>
                    </div>
                `;
            });
        }
    }
    
    window.filterProducts = function() {
        const searchInput = document.getElementById('search-item').value.toLowerCase().trim();
        
        const filteredList = todos_produtos_e_servicos.filter(item => 
            item.nome.toLowerCase().includes(searchInput)
        );
        
        renderItemsContainers(filteredList);
    }

Â  	
Â  	// --- PREENCHER DADOS DO CLIENTE (Mantido) ---
Â  	function preencherCliente() {
Â  Â  Â  	const clienteId = document.getElementById('select-cliente').value;
Â  Â  Â  	if (!clienteId) {
Â  Â  Â  Â  Â  	document.getElementById('cliente-nome').value = '';
Â  Â  Â  Â  Â  	document.getElementById('cliente-endereco').value = '';
Â  Â  Â  Â  Â  	clienteSelecionado = null;
Â  Â  Â  Â  Â  	return;
Â  Â  Â  	}
Â  Â  Â  	
Â  Â  Â  	clienteSelecionado = clientes_db.find(c => c.id === clienteId);
Â  Â  Â  	
Â  Â  Â  	document.getElementById('cliente-nome').value = clienteSelecionado.nome;
Â  Â  Â  	let enderecoCompleto = `${clienteSelecionado.enderecoRua || ''}, ${clienteSelecionado.enderecoNum || 'S/N'} - ${clienteSelecionado.enderecoBairro || ''}`;
Â  Â  Â  	document.getElementById('cliente-endereco').value = enderecoCompleto;
Â  	}

Â  	// --- LÃ“GICA DO CARRINHO (Mantido) ---
Â  	
Â  	function renderizarCarrinho() {
Â  Â  Â  	const container = document.getElementById('pedido-atual-container');
Â  Â  Â  	let subtotal = 0;
Â  Â  Â  	
Â  Â  Â  	if (carrinho.length === 0) {
Â  Â  Â  Â  Â  	container.innerHTML = '<p style="color: #9ca3af; text-align: center;">Adicione itens...</p>';
Â  Â  Â  	} else {
Â  Â  Â  Â  Â  	container.innerHTML = '';
Â  Â  Â  Â  Â  	carrinho.forEach((item, index) => {
Â  Â  Â  Â  Â  Â  Â  	subtotal += (item.precoTotal * item.quantidade);
Â  Â  Â  Â  Â  Â  Â  	
Â  Â  Â  Â  Â  Â  Â  	container.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="carrinho-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="carrinho-item-qty">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<button type="button" class="qty-btn" onclick="diminuirQuantidade(${index})">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<span class="qty-display">${item.quantidade}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<button type="button" class="qty-btn" onclick="aumentarQuantidade(${index})">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="carrinho-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="nome">${item.nome}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<div class="carrinho-preco">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	R$ <input type="number" step="0.01" class="input-preco" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	value="${item.precoTotal.toFixed(2)}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	onchange="atualizarPreco(${index}, this.value)"> / un
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  t Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<span class="carrinho-preco-total">R$ ${(item.precoTotal * item.quantidade).toFixed(2)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  	<button type="button" class="btn-excluir" onclick="removerDoCarrinho(${index})">Excluir</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  	</div>
Â  Â  Â  Â  Â  Â  Â  	`;
Â  Â  Â  Â  Â  	});
Â  Â  Â  	}
Â  Â  Â  	
Â  Â  Â  	document.getElementById('total-carrinho').textContent = `Total: R$ ${subtotal.toFixed(2)}`;
Â  	}
Â  	
Â  	window.atualizarPreco = (index, novoPreco) => {
Â  Â  Â  	const preco = parseFloat(novoPreco.replace(',', '.'));
Â  Â  Â  	if (isNaN(preco) || preco < 0) {
Â  Â  Â  Â  Â  	renderizarCarrinho(); 
Â  Â  Â  Â  Â  	return;
Â  Â  Â  	}
Â  Â  Â  	carrinho[index].precoTotal = preco; 
Â  Â  Â  	renderizarCarrinho(); 
Â  	}
Â  	
Â  	window.aumentarQuantidade = (index) => {
Â  Â  Â  	carrinho[index].quantidade++;
Â  Â  Â  	renderizarCarrinho();
Â  	}
Â  	
Â  	window.diminuirQuantidade = (index) => {
Â  Â  Â  	carrinho[index].quantidade--;
Â  Â  Â  	if (carrinho[index].quantidade <= 0) {
Â  Â  Â  Â  Â  	removerDoCarrinho(index);
Â  Â  Â  	} else {
Â  Â  Â  Â  Â  	renderizarCarrinho();
Â  Â  Â  	}
Â  	}
Â  	
Â  	window.removerDoCarrinho = (index) => {
Â  Â  Â  	carrinho.splice(index, 1);
Â  Â  Â  	renderizarCarrinho();
Â  	}

Â  	window.adicionarProduto = (id) => {
Â  Â  Â  	const indexExistente = carrinho.findIndex(item => item.tipo === 'produto' && item.itemId === id);
Â  Â  Â  	
Â  Â  Â  	if (indexExistente > -1) {
Â  Â  Â  Â  Â  	aumentarQuantidade(indexExistente);
Â  Â  Â  	} else {
Â  Â  Â  Â  Â  	const produto = produtos_db.find(p => p.id === id);
Â  Â  Â  Â  Â  	carrinho.push({
Â  Â  Â  Â  Â  Â  Â  	itemId: id, 
Â  Â  Â  Â  Â  Â  Â  	tipo: 'produto',
Â  Â  Â  Â  Â  Â  Â  	nome: produto.nome,
Â  Â  Â  Â  Â  Â  Â  	precoTotal: produto.preco, 
Â  Â  Â  Â  Â  Â  Â  	quantidade: 1
Â  Â  Â  Â  Â  	});
Â  Â  Â  Â  Â  	renderizarCarrinho();
Â  Â  Â  	}
Â  	}

Â  	window.adicionarServico = (id) => {
Â  Â  Â  	const indexExistente = carrinho.findIndex(item => item.tipo === 'servico' && item.itemId === id);

Â  Â  Â  	if (indexExistente > -1) {
Â  Â  Â  Â  Â  	aumentarQuantidade(indexExistente);
Â  Â  Â  	} else {
Â  Â  Â  Â  Â  	const servico = servicos_avulsos.find(s => s.id === id);
source_id: "s0",
Â  Â  Â  Â  Â  	carrinho.push({
Â  Â  Â  Â  Â  Â  Â  	itemId: id,
Â  Â  Â  Â  Â  Â  Â  	tipo: 'servico',
Â  Â  Â  Â  Â  Â  Â  	nome: servico.nome,
Â  Â  Â  Â  Â  Â  Â  	precoTotal: servico.preco, 
source_id: "s0",
Â  Â  Â  Â  Â  Â  Â  	quantidade: 1
Â  Â  Â  Â  Â  	});
Â  Â  Â  Â  Â  	renderizarCarrinho();
Â  Â  Â  	}
Â  	}

Â  	// --- LÃ“GICA DO FORMULÃRIO ---
Â  	
Â  	window.toggleTroco = (valor) => {
Â  Â  Â  	document.getElementById('troco-section').style.display = (valor === 'dinheiro') ? 'block' : 'none';
Â  	}
Â  	
Â  	// --- â­ LÃ“GICA DE ENVIO CORRIGIDA (PIX VAI PARA SERVIÃ‡OS DO DIA) ---
Â  	
Â  	async function enviarPedido(e) {
Â  Â  Â  	e.preventDefault();
Â  Â  Â  	const submitBtn = document.getElementById('btn-enviar-manual');
Â  Â  Â  	
Â  Â  Â  	if (!clienteSelecionado) {
Â  Â  Â  Â  Â  	alert('Por favor, selecione um cliente da lista!');
Â  Â  Â  Â  Â  	return;
Â  Â  Â  	}
Â  Â  Â  	
Â  Â  Â  	const pagamentoSelect = document.getElementById('pagamento');
Â  Â  Â  	let metodoPagamento = pagamentoSelect.options[pagamentoSelect.selectedIndex].text;
Â  Â  Â  	let tipoPagamentoValue = pagamentoSelect.value; 

        // â­ CORREÃ‡ÃƒO 2: Se o carrinho estiver vazio MAS for "LanÃ§ar na Mensalidade", adiciona a mensalidade
        if (carrinho.length === 0 && tipoPagamentoValue === 'mensalidade') {
            // Adiciona o item "CobranÃ§a de Mensalidade" (s0) automaticamente
            const servicoMensalidade = servicos_avulsos.find(s => s.id === 's0');
            if (servicoMensalidade) {
                 carrinho.push({
                    itemId: servicoMensalidade.id,
Â  Â  Â  Â  Â  Â  Â  		tipo: 'servico',
Â  Â  Â  Â  Â  Â  Â  		nome: servicoMensalidade.nome,
                    // O preÃ§o 0.00 serÃ¡ atualizado no faturamento com a mensalidade do cliente
Â  Â  Â  Â  Â  Â  Â  		precoTotal: 0.00, 
Â  Â  Â  Â  Â  Â  Â  		quantidade: 1
                });
                renderizarCarrinho(); // Atualiza a UI antes de prosseguir
            }
        } else if (carrinho.length === 0) {
            // Se o carrinho estiver vazio e NÃƒO for "LanÃ§ar na Mensalidade"
            alert('O carrinho estÃ¡ vazio!');
Â  Â  Â  Â  Â  	return;
        }
Â  Â  Â  	
Â  Â  Â  	submitBtn.disabled = true;
Â  Â  Â  	submitBtn.textContent = 'Enviando...';

Â  Â  Â  	if (tipoPagamentoValue === 'dinheiro' && document.getElementById('troco-valor').value) {
Â  Â  Â  Â  Â  	metodoPagamento += ` (Troco para: R$ ${document.getElementById('troco-valor').value})`;
Â  Â  Â  	}

Â  Â  Â  	var subtotal = carrinho.reduce((sum, item) => sum + (item.precoTotal * item.quantidade), 0);
Â  Â  Â  	
Â  Â  Â  	const pedidoCompleto = {
Â  Â  Â  Â  Â  	cliente: clienteSelecionado, 
Â  Â  Â  Â  Â  	itens: carrinho,
Â  Â  Â  Â  Â  	pagamento: metodoPagamento, 
Â  Â  Â  Â  Â  	total: subtotal,
Â  Â  Â  Â  Â  	status: 'Pendente', // â­ CORREÃ‡ÃƒO 1: Todo pedido comeÃ§a como 'Pendente'
Â  Â  Â  Â  Â  	hora: new Date().toISOString(),
Â  Â  Â  Â  Â  	faturado: false 
Â  Â  Â  	};
Â  Â  Â  	
Â  Â  Â  	try {
Â  Â  Â  Â  Â  	// â­ CORREÃ‡ÃƒO 1: Todos os pedidos sÃ£o salvos no nÃ³ 'servicos'
            // O 'servicos_do_dia.html' vai ler daqui
Â  Â  Â  Â  Â  	await push(pedidosRef, pedidoCompleto);
            
            if (tipoPagamentoValue !== 'mensalidade') {
                alert(`Venda rÃ¡pida (PIX, CartÃ£o, etc.) no valor de R$ ${subtotal.toFixed(2)} foi lanÃ§ada em "ServiÃ§os do Dia".`);
            } else {
Â  Â  Â  Â  Â  Â  Â  	alert('ServiÃ§o/Venda lanÃ§ado com sucesso para "ServiÃ§os do Dia" (para faturamento futuro)!');
Â  Â  Â  Â  Â  	}

Â  Â  Â  Â  Â  	// Limpa tudo
Â  Â  Â  Â  Â  	carrinho = [];
Â  Â  Â  Â  Â  	clienteSelecionado = null;
Â  Â  Â  Â  Â  	document.getElementById('form-manual').reset(); 
Â  Â  Â  Â  Â  	toggleTroco(''); 
            filterClients(); // Limpa o filtro de clientes
            filterProducts(); // Limpa o filtro de produtos
Â  Â  Â  Â  Â  	renderizarCarrinho();
Â  Â  Â  Â  Â  	
Â  Â  Â  	} catch (error) {
Â  Â  Â  Â  Â  	console.error("Erro ao enviar pedido: ", error);
Â  Â  Â  Â  Â  	alert('Erro ao enviar pedido. Tente novamente.');
Â  Â  Â  	} finally {
Â  Â  Â  Â  Â  	submitBtn.disabled = false;
Â  Â  Â  Â  Â  	submitBtn.textContent = 'LanÃ§ar ServiÃ§o/Venda';
Â  Â  Â  	}
Â  	}
Â  	
Â  	// --- INICIALIZAÃ‡ÃƒO DAS FUNÃ‡Ã•ES GLOBAIS ---
Â  	window.toggleTroco = toggleTroco;
Â  	window.adicionarProduto = adicionarProduto;
Â  	window.adicionarServico = adicionarServico;
Â  	window.removerDoCarrinho = removerDoCarrinho;
Â  	window.aumentarQuantidade = aumentarQuantidade;
Â  	window.diminuirQuantidade = diminuirQuantidade;
Â  	window.atualizarPreco = atualizarPreco;
    window.filterClients = filterClients; 
    window.filterProducts = filterProducts; 
    window.preencherCliente = preencherCliente; 

</script>
</body>
</html>
